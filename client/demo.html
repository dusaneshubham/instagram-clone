<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
</head>

<body ng-app='instagramApp'>

    <div ng-controller="userCtrl">

        <input type='file' multiple ng-file='uploadfiles'><br />
        <input type='button' value='Upload' id='upload' ng-click='upload($event)'>

        <p>{{ response.name }}</p>
    </div>

    <script>
        var upload = angular.module('myapp', []);
        upload.directive('ngFile', ['$parse', function($parse) {
            return {
                restrict: 'A',
                link: function(scope, element, attrs) {
                    element.bind('change', function() {

                        $parse(attrs.ngFile).assign(scope, element[0].files)
                        scope.$apply();
                    });
                }
            };
        }]);

        upload.controller('userCtrl', ['$scope', '$http', function($scope, $http) {
            $scope.upload = function() {


                var fd = new FormData();
                fd.append("_id", "621203888c633115a94bf9b1");
                fd.append("title", "Good post")
                angular.forEach($scope.uploadfiles, function(file) {
                    fd.append('photo', file);
                });

                // var req = {
                //     method: 'post',
                //     url: 'http://localhost:3000/post/data',
                //     headers: {
                //         'Content-Type': undefined
                //     },
                //     data: { name : "jil", fd}
                // }



                $http.post('http://localhost:3000/post/create-post', fd, {
                        headers: {
                            'Content-Type': undefined
                        }
                    })
                    .then(res => {
                        alert(res.data)
                    })
                    // $http({
                    //     method: 'post',
                    //     url: 'http://localhost:3000/post/data',
                    //     data: JSON.stringify(da),
                    //     headers: { 'Content-Type': undefined },
                    // }).then((res)=>{
                    //     alert(res.data)
                    // })
            }

        }]);
    </script>


</body>

</html>